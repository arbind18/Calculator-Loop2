<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIP Calculator 2025 - Systematic Investment Plan with Step-up & Inflation</title>
    <link rel="icon" type="image/svg+xml" href="../../assets/images/logo.svg">
    <meta name="description" content="Calculate your SIP returns with Step-up (Top-up) options and Inflation adjustment. Visualize your wealth creation journey with professional charts and reports.">
    
    <!-- Schema Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Advanced SIP Calculator",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "INR"
      },
      "description": "A professional SIP Calculator that helps you estimate the future value of your monthly investments with options for annual step-up and inflation adjustments.",
      "featureList": "SIP Calculation, Step-up SIP, Inflation Adjustment, Growth Chart, PDF Report"
    }
    </script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Manrope:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Global Settings -->
    <link rel="stylesheet" href="../../assets/css/settings.css">
    <script src="../../assets/js/settings.js" defer></script>
    <script src="../../assets/js/google-translate-loader.js" defer></script>

    <style>
        :root {
            --bg-primary: #FFFFFF; --bg-secondary: #F8FAFC; --bg-tertiary: #F1F5F9;
            --text-primary: #1A1F3A; --text-secondary: #64748B; --text-muted: #94A3B8;
            --accent-blue: #00D4FF; --accent-purple: #8B5CF6; --accent-green: #00FF88;
            --gradient-ai: linear-gradient(135deg, #00D4FF 0%, #8B5CF6 100%);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05); --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1); --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.15);
            --font-primary: 'Poppins', sans-serif; --font-secondary: 'Inter', sans-serif;
            --radius-md: 12px; --radius-lg: 16px;
            --space-md: 16px; --space-lg: 24px; --space-xl: 32px;
        }

        [data-theme="dark"] {
            --bg-primary: #0A0E27; --bg-secondary: #1A1F3A; --bg-tertiary: #252B4A;
            --text-primary: #FFFFFF; --text-secondary: #94A3B8; --text-muted: #64748B;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-secondary); background-color: var(--bg-secondary); color: var(--text-primary); line-height: 1.6; transition: background-color 0.3s, color 0.3s; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 0 var(--space-md); }
        
        header { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.05); padding: var(--space-md) 0; }
        [data-theme="dark"] header { background: rgba(10, 14, 39, 0.8); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: var(--font-primary); font-weight: 700; font-size: 1.5rem; background: var(--gradient-ai); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-decoration: none; }

        .page-header { text-align: center; padding: var(--space-xl) 0; }
        .page-title { font-size: 2.5rem; margin-bottom: 8px; background: var(--gradient-ai); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .page-subtitle { color: var(--text-secondary); font-size: 1.1rem; max-width: 600px; margin: 0 auto; }

        .calculator-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg); margin-bottom: var(--space-xl); }
        @media (max-width: 968px) { .calculator-grid { grid-template-columns: 1fr; } }

        .card { background: var(--bg-primary); border-radius: var(--radius-lg); padding: var(--space-lg); box-shadow: var(--shadow-md); border: 1px solid var(--bg-tertiary); }
        
        .form-group { margin-bottom: var(--space-md); }
        .form-label { display: block; margin-bottom: 4px; font-weight: 500; color: var(--text-primary); font-size: 0.95rem; }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        .input-icon { position: absolute; left: 12px; color: var(--text-muted); font-size: 1rem; pointer-events: none; }
        .form-input { width: 100%; padding: 12px 12px 12px 40px; border: 2px solid var(--bg-tertiary); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary); font-family: var(--font-secondary); font-size: 1rem; transition: all 0.3s; }
        .form-input:focus { outline: none; border-color: var(--accent-purple); background: var(--bg-primary); }
        
        .range-slider { width: 100%; margin-top: 8px; height: 6px; background: var(--bg-tertiary); border-radius: 3px; outline: none; -webkit-appearance: none; }
        .range-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: var(--accent-purple); border-radius: 50%; cursor: pointer; transition: transform 0.2s; }
        .range-slider::-webkit-slider-thumb:hover { transform: scale(1.2); }

        .results-summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-md); margin-bottom: var(--space-lg); text-align: center; }
        .summary-item { padding: var(--space-md); background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--bg-tertiary); }
        .summary-label { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 4px; }
        .summary-value { font-size: 1.2rem; font-weight: 700; color: var(--text-primary); }
        .summary-value.highlight { color: var(--accent-purple); font-size: 1.4rem; }

        .chart-container { position: relative; height: 300px; width: 100%; margin-top: var(--space-md); }
        
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 12px 24px; border-radius: var(--radius-md); font-weight: 600; cursor: pointer; transition: all 0.3s; border: none; font-size: 1rem; }
        .btn-primary { background: var(--gradient-ai); color: white; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4); }
        .btn-outline { background: transparent; border: 2px solid var(--bg-tertiary); color: var(--text-primary); }
        .btn-outline:hover { border-color: var(--accent-purple); color: var(--accent-purple); background: var(--bg-secondary); }

        .table-container { overflow-x: auto; margin-top: var(--space-lg); border-radius: var(--radius-md); border: 1px solid var(--bg-tertiary); }
        table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        th, td { padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--bg-tertiary); }
        th { background: var(--bg-secondary); font-weight: 600; color: var(--text-secondary); white-space: nowrap; }
        tr:hover { background: var(--bg-secondary); }

        .toggle-switch { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .toggle-input { display: none; }
        .toggle-slider { width: 44px; height: 24px; background: var(--bg-tertiary); border-radius: 24px; position: relative; transition: 0.3s; }
        .toggle-slider::before { content: ''; position: absolute; width: 18px; height: 18px; background: white; border-radius: 50%; top: 3px; left: 3px; transition: 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .toggle-input:checked + .toggle-slider { background: var(--accent-purple); }
        .toggle-input:checked + .toggle-slider::before { transform: translateX(20px); }

        .chart-controls { display: flex; gap: 10px; margin-bottom: 15px; justify-content: center; }
        .chart-tab { padding: 8px 16px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 20px; font-weight: 600; transition: all 0.3s; border: 1px solid transparent; }
        .chart-tab:hover { background: var(--bg-tertiary); }
        .chart-tab.active { background: var(--gradient-ai); color: white; box-shadow: 0 4px 10px rgba(139, 92, 246, 0.3); }

        .advanced-toggle { display: flex; align-items: center; justify-content: space-between; padding: var(--space-md); background: var(--bg-secondary); border-radius: var(--radius-md); cursor: pointer; margin-top: var(--space-md); font-weight: 500; transition: background 0.3s; }
        .advanced-toggle:hover { background: var(--bg-tertiary); }
        .advanced-section { display: none; padding: var(--space-md); border: 1px solid var(--bg-tertiary); border-top: none; border-radius: 0 0 var(--radius-md) var(--radius-md); animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Settings Dropdown */
        .settings-dropdown { position: relative; display: inline-block; margin-left: 0.5rem; }
        .settings-toggle { background: transparent; border: none; color: var(--text-primary); font-size: 1.2rem; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: background-color 0.3s ease; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; }
        .settings-toggle:hover { background-color: var(--bg-tertiary); }
        .settings-menu { position: absolute; top: 120%; right: 0; background-color: var(--bg-primary); border: 1px solid rgba(0,0,0,0.1); border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); min-width: 260px; padding: 0.5rem; z-index: 1000; display: none; opacity: 0; transform: translateY(-10px); transition: opacity 0.2s ease, transform 0.2s ease; }
        [data-theme="dark"] .settings-menu { border: 1px solid rgba(255,255,255,0.1); }
        .settings-menu.active { display: block; opacity: 1; transform: translateY(0); }
        .settings-header { padding: 0.5rem 1rem; font-weight: 600; color: var(--text-primary); border-bottom: 1px solid var(--bg-tertiary); margin-bottom: 0.5rem; }
        .settings-item { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1rem; color: var(--text-primary); font-weight: 500; border-radius: 0.5rem; transition: background-color 0.2s ease; }
        .settings-item:hover { background-color: var(--bg-secondary); }
        .settings-item span { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; }
        .settings-select { background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--bg-tertiary); border-radius: 0.375rem; padding: 0.25rem 0.5rem; font-size: 0.85rem; outline: none; cursor: pointer; max-width: 120px; }

        @media print {
            header, .chart-controls, .action-buttons, footer, .toggle-switch, .advanced-toggle { display: none !important; }
            .card { box-shadow: none; border: 1px solid #ddd; }
            body { background: white; color: black !important; }
            .advanced-section { display: block !important; border: none; }
        }
    </style>
</head>
<body>

    <header>
        <div class="container header-content">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <a href="../../Ui.html?category=financial" style="display: inline-flex; align-items: center; justify-content: center; background: none; border: none; color: var(--text-primary); font-size: 1.2rem; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: background 0.3s; text-decoration: none;" onmouseover="this.style.background='var(--bg-tertiary)'" onmouseout="this.style.background='transparent'" title="Back to Financial Calculators">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <a href="../../Ui.html" class="logo">
                    <i class="fas fa-infinity"></i> Calculator Loop
                </a>
            </div>
            
            <div class="settings-dropdown">
                <button class="settings-toggle" id="settingsToggle">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="settings-menu" id="settingsMenu">
                    <div class="settings-header" data-i18n="settings">Settings</div>
                    <div class="settings-item">
                        <span><i class="fas fa-moon"></i> <span data-i18n="dark_mode">Dark Mode</span></span>
                        <button class="theme-toggle" id="themeToggle">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                    <div class="settings-item">
                        <span><i class="fas fa-globe"></i> <span data-i18n="language">Language</span></span>
                        <select id="headerLangSelect" class="settings-select"></select>
                    </div>
                    <div class="settings-item">
                        <span><i class="fas fa-coins"></i> <span data-i18n="currency">Currency</span></span>
                        <select id="headerCurrencySelect" class="settings-select"></select>
                    </div>
                    <div style="border-top: 1px solid var(--bg-tertiary); margin: 0.5rem 0;"></div>
                    <div class="settings-item" onclick="shareCalculator()" style="cursor:pointer">
                        <span><i class="fas fa-share-alt"></i> <span data-i18n="share">Share Tool</span></span>
                    </div>
                    <div class="settings-item" onclick="printReport()" style="cursor:pointer">
                        <span><i class="fas fa-print"></i> <span data-i18n="print">Print Report</span></span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="page-header">
            <h1 class="page-title">SIP Calculator</h1>
            <p class="page-subtitle">Calculate the future value of your monthly investments with Step-up and Inflation options.</p>
            
            <div style="display: flex; justify-content: center; margin-top: 1.5rem;">
                <label class="toggle-switch" style="background: var(--bg-primary); padding: 0.5rem 1rem; border-radius: 2rem; box-shadow: var(--shadow-sm); border: 1px solid var(--bg-tertiary);">
                    <input type="checkbox" id="autoCalculateCheck" class="toggle-input" checked onchange="toggleAutoCalculate()">
                    <span class="toggle-slider"></span>
                    <span class="form-label" style="margin:0; font-weight: 500; color: var(--text-primary);">Auto Calculate Mode</span>
                </label>
            </div>
        </div>

        <div class="calculator-grid">
            <!-- Input Section -->
            <div class="card">
                <h3 style="margin-bottom: var(--space-lg);">Investment Details</h3>
                
                <div class="form-group">
                    <label class="form-label">Monthly Investment (<span class="currency-symbol">₹</span>)</label>
                    <div class="input-wrapper">
                        <i class="fas fa-rupee-sign input-icon currency-icon"></i>
                        <input type="number" id="monthlyInvestment" class="form-input" value="5000" oninput="syncRange('investmentRange', this.value)">
                    </div>
                    <input type="range" id="investmentRange" class="range-slider" min="500" max="100000" step="500" value="5000" oninput="syncInput('monthlyInvestment', this.value)">
                </div>

                <div class="form-group">
                    <label class="form-label">Expected Return Rate (p.a) %</label>
                    <div class="input-wrapper">
                        <i class="fas fa-percent input-icon"></i>
                        <input type="number" id="returnRate" class="form-input" value="12" oninput="syncRange('rateRange', this.value)">
                    </div>
                    <input type="range" id="rateRange" class="range-slider" min="1" max="30" step="0.5" value="12" oninput="syncInput('returnRate', this.value)">
                </div>

                <div class="form-group">
                    <label class="form-label">Time Period (Years)</label>
                    <div class="input-wrapper">
                        <i class="fas fa-calendar-alt input-icon"></i>
                        <input type="number" id="timePeriod" class="form-input" value="10" oninput="syncRange('timeRange', this.value)">
                    </div>
                    <input type="range" id="timeRange" class="range-slider" min="1" max="50" step="1" value="10" oninput="syncInput('timePeriod', this.value)">
                </div>

                <div class="advanced-toggle" onclick="toggleAdvanced()">
                    <span><i class="fas fa-sliders-h"></i> Advanced Options (Step-up & Inflation)</span>
                    <i class="fas fa-chevron-down" id="advancedIcon"></i>
                </div>
                <div class="advanced-section" id="advancedSection">
                    <div class="form-group">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <label class="form-label" style="margin-bottom: 0;">Annual Step-up (Top-up)?</label>
                            <label class="toggle-switch" style="transform: scale(0.8);">
                                <input type="checkbox" id="stepUpCheck" class="toggle-input" onchange="updateValues()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="stepUpInput" style="display: none;">
                            <div class="input-wrapper">
                                <i class="fas fa-level-up-alt input-icon"></i>
                                <input type="number" id="stepUpRate" class="form-input" value="10" placeholder="Step-up Rate %" oninput="updateValues()">
                            </div>
                            <small style="color: var(--text-muted);">Increase investment by % every year</small>
                        </div>
                    </div>

                    <div class="form-group" style="margin-bottom: 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <label class="form-label" style="margin-bottom: 0;">Adjust for Inflation?</label>
                            <label class="toggle-switch" style="transform: scale(0.8);">
                                <input type="checkbox" id="inflationCheck" class="toggle-input" onchange="updateValues()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="inflationInput" style="display: none;">
                            <div class="input-wrapper">
                                <i class="fas fa-chart-line input-icon"></i>
                                <input type="number" id="inflationRate" class="form-input" value="6" placeholder="Inflation Rate %" oninput="updateValues()">
                            </div>
                            <small style="color: var(--text-muted);">Expected inflation rate (e.g., 6%)</small>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="btn btn-outline" style="width: 100%;" onclick="clearInputs()">
                        <i class="fas fa-undo"></i> Clear
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="card">
                <h3 style="margin-bottom: var(--space-lg);">Investment Summary</h3>
                
                <button id="calculateBtn" class="btn btn-primary" style="width: 100%; margin-bottom: var(--space-xl); display: none;" onclick="updateValues(true)">
                    <i class="fas fa-calculator"></i> Calculate Now
                </button>
                
                <div class="results-summary">
                    <div class="summary-item">
                        <div class="summary-label">Invested Amount</div>
                        <div class="summary-value" id="totalInvested">₹0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Wealth Gained</div>
                        <div class="summary-value" id="wealthGained">₹0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total Value</div>
                        <div class="summary-value highlight" id="totalValue">₹0</div>
                    </div>
                </div>

                <div class="chart-controls">
                    <button class="chart-tab active" onclick="switchChartType('doughnut')" id="tabDoughnut">
                        <i class="fas fa-chart-pie"></i> Breakdown
                    </button>
                    <button class="chart-tab" onclick="switchChartType('line')" id="tabLine">
                        <i class="fas fa-chart-line"></i> Growth
                    </button>
                </div>

                <div class="chart-container">
                    <canvas id="sipChart"></canvas>
                </div>

                <div id="chartInsight" style="margin-top: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 12px; border-left: 4px solid var(--accent-purple);">
                    <!-- Dynamic Insight -->
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: center;">
                    <button class="btn btn-outline" onclick="shareCalculator()" title="Share">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <button class="btn btn-outline" onclick="printReport()" title="Print">
                        <i class="fas fa-print"></i>
                    </button>
                    <button class="btn btn-outline" onclick="downloadPDF()" title="Download PDF">
                        <i class="fas fa-file-pdf"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Yearly Breakdown -->
        <div class="card" id="yearlyTableCard" style="display: none; margin-bottom: var(--space-xl);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md);">
                <h3>Yearly Breakdown</h3>
                <div class="action-buttons">
                    <button class="btn btn-outline" onclick="downloadPDF()">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                </div>
            </div>
            <div class="table-container">
                <table id="breakdownTable">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Monthly Inv.</th>
                            <th>Total Invested</th>
                            <th>Interest Earned</th>
                            <th>Total Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <div style="text-align: center; margin-bottom: var(--space-xl);">
            <button class="btn btn-outline" onclick="toggleTable()" id="tableToggleBtn">
                <i class="fas fa-table"></i> View Yearly Details
            </button>
        </div>

    </main>

    <script>
        // --- UI Logic ---
        function syncRange(rangeId, value) {
            document.getElementById(rangeId).value = value;
            updateValues();
        }

        function syncInput(inputId, value) {
            document.getElementById(inputId).value = value;
            updateValues();
        }

        function toggleAutoCalculate() {
            const isAuto = document.getElementById('autoCalculateCheck').checked;
            const btn = document.getElementById('calculateBtn');
            
            if (isAuto) {
                btn.style.display = 'none';
                updateValues();
            } else {
                btn.style.display = 'block';
            }
        }

        function toggleAdvanced() {
            const section = document.getElementById('advancedSection');
            const icon = document.getElementById('advancedIcon');
            if (section.style.display === 'block') {
                section.style.display = 'none';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            } else {
                section.style.display = 'block';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            }
        }

        function toggleTable() {
            const card = document.getElementById('yearlyTableCard');
            const btn = document.getElementById('tableToggleBtn');
            if (card.style.display === 'none') {
                card.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-chevron-up"></i> Hide Yearly Details';
                card.scrollIntoView({ behavior: 'smooth' });
            } else {
                card.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-table"></i> View Yearly Details';
            }
        }

        // --- Chart Logic ---
        let sipChart = null;
        let currentChartType = 'doughnut';

        function switchChartType(type) {
            currentChartType = type;
            document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(type === 'doughnut' ? 'tabDoughnut' : 'tabLine').classList.add('active');
            updateValues(true);
        }

        function updateChart(invested, interest, yearlyData) {
            const ctx = document.getElementById('sipChart').getContext('2d');
            if (sipChart) sipChart.destroy();

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const textColor = isDark ? '#e2e8f0' : '#1e293b';
            const gridColor = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';

            if (currentChartType === 'doughnut') {
                sipChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Invested Amount', 'Wealth Gained'],
                        datasets: [{
                            data: [invested, interest],
                            backgroundColor: ['#8B5CF6', '#00D4FF'],
                            borderWidth: 0,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom', labels: { color: textColor, padding: 20, font: { family: 'Inter', size: 12 } } },
                            tooltip: {
                                backgroundColor: isDark ? '#1e293b' : '#ffffff',
                                titleColor: isDark ? '#ffffff' : '#1e293b',
                                bodyColor: isDark ? '#cbd5e1' : '#475569',
                                borderColor: isDark ? '#334155' : '#e2e8f0',
                                borderWidth: 1,
                                padding: 12,
                                callbacks: { label: function(context) { return context.label + ': ' + formatCurrency(context.raw); } }
                            }
                        },
                        cutout: '70%'
                    }
                });
            } else {
                const labels = yearlyData.map(d => `Year ${d.year}`);
                const totalData = yearlyData.map(d => d.total);
                const investedData = yearlyData.map(d => d.invested);

                sipChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'Total Value', data: totalData, borderColor: '#00D4FF', backgroundColor: 'rgba(0, 212, 255, 0.1)', fill: true, tension: 0.4 },
                            { label: 'Invested Amount', data: investedData, borderColor: '#8B5CF6', borderDash: [5, 5], fill: false, tension: 0.4 }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: textColor } },
                            tooltip: { mode: 'index', intersect: false, callbacks: { label: function(context) { return context.dataset.label + ': ' + formatCurrency(context.raw); } } }
                        },
                        scales: {
                            x: { grid: { color: gridColor }, ticks: { color: textColor } },
                            y: { grid: { color: gridColor }, ticks: { color: textColor } }
                        },
                        interaction: { mode: 'index', intersect: false }
                    }
                });
            }
        }

        function updateInsight(invested, interest, total, years, realValue) {
            const percentage = ((interest / invested) * 100).toFixed(1);
            const element = document.getElementById('chartInsight');
            
            let insightText = `Over <b>${years} years</b>, your SIP grows by <b>${percentage}%</b>. <br>You invested <b>${formatCurrency(invested)}</b> and gained <b>${formatCurrency(interest)}</b>.`;
            
            if (realValue) {
                insightText += `<br><span style="font-size: 0.85rem; color: var(--text-muted);">Inflation Adjusted Value: <b>${formatCurrency(realValue)}</b></span>`;
            }
            
            if(element) {
                element.innerHTML = `
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                        <div style="background: rgba(139, 92, 246, 0.1); padding: 10px; border-radius: 50%; color: var(--accent-purple);">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px; color: var(--text-primary);">AI Assistant</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5;">
                                ${insightText}
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // --- Core Calculation ---
        function updateValues(force = false) {
            const isAuto = document.getElementById('autoCalculateCheck') ? document.getElementById('autoCalculateCheck').checked : true;
            if (!isAuto && !force) return;

            let monthlyInvestment = parseFloat(document.getElementById('monthlyInvestment').value) || 0;
            let rate = parseFloat(document.getElementById('returnRate').value) || 0;
            let years = parseFloat(document.getElementById('timePeriod').value) || 0;
            
            const isStepUp = document.getElementById('stepUpCheck').checked;
            const isInflation = document.getElementById('inflationCheck').checked;
            
            document.getElementById('stepUpInput').style.display = isStepUp ? 'block' : 'none';
            document.getElementById('inflationInput').style.display = isInflation ? 'block' : 'none';

            let stepUpRate = isStepUp ? (parseFloat(document.getElementById('stepUpRate').value) || 0) : 0;
            let inflationRate = isInflation ? (parseFloat(document.getElementById('inflationRate').value) || 0) : 0;

            let yearlyData = [];
            let currentCorpus = 0;
            let totalInvested = 0;
            let currentMonthlyInv = monthlyInvestment;
            const monthlyRate = rate / 12 / 100;

            for (let y = 1; y <= years; y++) {
                // Calculate for 12 months
                for (let m = 1; m <= 12; m++) {
                    currentCorpus += currentMonthlyInv;
                    currentCorpus *= (1 + monthlyRate);
                    totalInvested += currentMonthlyInv;
                }

                yearlyData.push({
                    year: y,
                    monthlyInv: currentMonthlyInv,
                    invested: totalInvested,
                    interest: currentCorpus - totalInvested,
                    total: currentCorpus
                });

                // Apply Step-up for next year
                if (isStepUp) {
                    currentMonthlyInv += currentMonthlyInv * (stepUpRate / 100);
                }
            }

            let realValue = null;
            if (isInflation) {
                realValue = currentCorpus / Math.pow(1 + inflationRate/100, years);
            }

            // Update UI
            document.getElementById('totalInvested').innerText = formatCurrency(totalInvested);
            document.getElementById('wealthGained').innerText = formatCurrency(currentCorpus - totalInvested);
            document.getElementById('totalValue').innerText = formatCurrency(currentCorpus);

            updateChart(totalInvested, currentCorpus - totalInvested, yearlyData);
            updateInsight(totalInvested, currentCorpus - totalInvested, currentCorpus, years, realValue);
            updateTable(yearlyData);
        }

        function formatCurrency(num) {
            return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(num);
        }

        function updateTable(data) {
            const tbody = document.querySelector('#breakdownTable tbody');
            tbody.innerHTML = '';
            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.year}</td>
                    <td>${formatCurrency(row.monthlyInv)}</td>
                    <td>${formatCurrency(row.invested)}</td>
                    <td>${formatCurrency(row.interest)}</td>
                    <td><strong>${formatCurrency(row.total)}</strong></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function cleanCurrency(str) { return str.replace(/[^0-9.-]+/g, ""); }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(139, 92, 246);
            doc.text("SIP Investment Report", 105, 20, null, null, 'center');
            
            doc.setFontSize(10);
            doc.setTextColor(100);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 30, null, null, 'center');

            const invested = document.getElementById('totalInvested').innerText;
            const returns = document.getElementById('wealthGained').innerText;
            const total = document.getElementById('totalValue').innerText;

            doc.setFillColor(248, 250, 252);
            doc.rect(20, 40, 170, 30, 'F');
            
            doc.setFontSize(12);
            doc.setTextColor(50);
            doc.text(`Invested Amount: ${invested}`, 30, 55);
            doc.text(`Wealth Gained: ${returns}`, 30, 65);
            
            doc.setFontSize(14);
            doc.setTextColor(139, 92, 246);
            doc.text(`Total Value: ${total}`, 120, 60);

            try {
                const canvas = document.getElementById('sipChart');
                const chartImg = canvas.toDataURL("image/png", 1.0);
                doc.addImage(chartImg, 'PNG', 65, 85, 80, 80);
            } catch (e) { console.error("Chart export failed", e); }

            const table = document.getElementById('breakdownTable');
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            const tableBody = rows.map(row => {
                const cells = row.querySelectorAll('td');
                return [
                    cells[0].innerText, 
                    cleanCurrency(cells[1].innerText), 
                    cleanCurrency(cells[2].innerText), 
                    cleanCurrency(cells[3].innerText),
                    cleanCurrency(cells[4].innerText)
                ];
            });

            doc.autoTable({
                head: [['Year', 'Monthly Inv.', 'Total Invested', 'Interest', 'Total Value']],
                body: tableBody,
                startY: 175,
                theme: 'grid',
                headStyles: { fillColor: [139, 92, 246], textColor: 255, fontStyle: 'bold', halign: 'center' },
                bodyStyles: { textColor: 50, halign: 'center' },
                alternateRowStyles: { fillColor: [248, 250, 252] },
                margin: { top: 10 },
            });

            const pageCount = doc.internal.getNumberOfPages();
            for(let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(150);
                doc.text('www.calculatorloop.com', 105, 290, null, null, 'center');
            }
            
            doc.save('SIP-Report.pdf');
        }

        function printReport() { window.print(); }
        function shareCalculator() {
            if (navigator.share) {
                navigator.share({ title: 'SIP Calculator', text: 'Check out this professional SIP Calculator!', url: window.location.href });
            } else {
                alert('Link copied to clipboard!');
                navigator.clipboard.writeText(window.location.href);
            }
        }

        // Settings Toggle Fallback
        document.getElementById('settingsToggle').addEventListener('click', function(e) {
            e.stopPropagation();
            const menu = document.getElementById('settingsMenu');
            menu.classList.toggle('active');
        });

        document.addEventListener('click', function(e) {
            const menu = document.getElementById('settingsMenu');
            const toggle = document.getElementById('settingsToggle');
            if (menu.classList.contains('active') && !menu.contains(e.target) && !toggle.contains(e.target)) {
                menu.classList.remove('active');
            }
        });

        function clearInputs() {
            document.getElementById('monthlyInvestment').value = 5000;
            document.getElementById('returnRate').value = 12;
            document.getElementById('timePeriod').value = 10;
            document.getElementById('stepUpCheck').checked = false;
            document.getElementById('stepUpRate').value = 10;
            document.getElementById('inflationCheck').checked = false;
            document.getElementById('inflationRate').value = 6;
            
            document.getElementById('investmentRange').value = 5000;
            document.getElementById('rateRange').value = 12;
            document.getElementById('timeRange').value = 10;
            
            document.getElementById('stepUpInput').style.display = 'none';
            document.getElementById('inflationInput').style.display = 'none';

            updateValues();
        }

        window.onload = function() {
            updateValues();
        };
    </script>
    <footer style="background: var(--bg-primary); border-top: 1px solid var(--bg-tertiary); padding: 2rem 0; margin-top: 3rem;">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
            <div style="font-size: 0.9rem; color: var(--text-secondary);">
                &copy; 2025 Calculator Loop. All rights reserved.
            </div>
            <div style="display: flex; gap: 1.5rem;">
                <a href="../../About/index.html" style="text-decoration: none; color: var(--text-secondary); font-size: 0.9rem; transition: color 0.2s;">About Us</a>
                <a href="../../Blog/index.html" style="text-decoration: none; color: var(--text-secondary); font-size: 0.9rem; transition: color 0.2s;">Blog</a>
                <a href="../../privacy-policy.html" style="text-decoration: none; color: var(--text-secondary); font-size: 0.9rem; transition: color 0.2s;">Privacy Policy</a>
                <a href="../../terms.html" style="text-decoration: none; color: var(--text-secondary); font-size: 0.9rem; transition: color 0.2s;">Terms of Use</a>
            </div>
        </div>
    </footer>
</body>
</html>
